<h1>JSON 规则配置文档</h1>
<h2>概述</h2>
<p>本文档描述了一个用于网页自动化操作的 JSON 规则配置格式。该配置可用于定义点击操作和数据抓取规则，支持重试机制和精确元素定位。</p>
<h2>基本结构</h2>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"click"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  <span class="token property">"selectors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  <span class="token property">"lists"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span></code></pre>
<h2>1. 点击规则 (<code>click</code>)</h2>
<p>定义需要执行的点击操作序列。</p>
<h3>单个点击规则结构</h3>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"CSS选择器"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"可选，元素索引（从0开始）"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  <span class="token property">"delay"</span><span class="token operator">:</span> <span class="token string">"可选，点击后等待时间（毫秒）"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">  <span class="token property">"retry"</span><span class="token operator">:</span> <span class="token string">"可选，最大重试次数"</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">}</span>
</span></code></pre>
<h3>示例</h3>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"click"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="3">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">".buttonOver18"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">      <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">      <span class="token property">"delay"</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">      <span class="token property">"retry"</span><span class="token operator">:</span> <span class="token number">5</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span>
</span></code></pre>
<h3>字段说明</h3>








































<table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>query</td><td>string</td><td>是</td><td>-</td><td>CSS选择器，用于定位元素</td></tr><tr><td>index</td><td>number</td><td>否</td><td>0</td><td>当有多个匹配元素时，指定要操作的元素索引（从0开始）</td></tr><tr><td>delay</td><td>number</td><td>否</td><td>1000</td><td>点击后等待的时间（毫秒）</td></tr><tr><td>retry</td><td>number</td><td>否</td><td>1</td><td>操作失败时的最大重试次数</td></tr></tbody></table>
<h2>2. 数据抓取规则 (<code>lists</code>)</h2>
<p>定义需要抓取的数据列表及其字段。</p>
<h3>单个列表规则结构</h3>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"CSS选择器"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="4">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"CSS选择器"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">      <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"属性类型"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">      <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"字段名称"</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span>
</span></code></pre>
<h3>示例</h3>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"lists"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="3">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"ul#singleFeedSection li.pcVideoListItem"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="6">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"a.latestThumb.js-linkVideoThumb"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"href"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="9">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频打开链接"</span>
</span><span class="code-line line-number" line="10">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="11">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"a.thumbnailTitle"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频标题"</span>
</span><span class="code-line line-number" line="15">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">      <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="17">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="18">  <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="19"><span class="token punctuation">}</span>
</span></code></pre>
<h3>字段说明</h3>
<h4>列表级字段</h4>























<table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>query</td><td>string</td><td>是</td><td>列表项的CSS选择器</td></tr><tr><td>items</td><td>array</td><td>是</td><td>要抓取的字段定义数组</td></tr></tbody></table>
<h4>字段级字段</h4>

































<table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>query</td><td>string</td><td>是</td><td>-</td><td>字段元素的CSS选择器（相对于列表项）</td></tr><tr><td>attr</td><td>string</td><td>是</td><td>-</td><td>要获取的属性类型：<code>text</code>、<code>html</code>、<code>outerHTML</code> 或任意HTML属性名</td></tr><tr><td>label</td><td>string</td><td>是</td><td>-</td><td>字段名称，将作为结果对象的键名</td></tr></tbody></table>
<h2>3. 选择器规则 (<code>selectors</code>)</h2>
<p>（保留字段，当前版本未实现具体功能）</p>
<h2>完整示例</h2>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token property">"click"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="3">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">".buttonOver18"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">      <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">      <span class="token property">"delay"</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">      <span class="token property">"retry"</span><span class="token operator">:</span> <span class="token number">5</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">  <span class="token property">"selectors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="11">  <span class="token property">"lists"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"ul#singleFeedSection li.pcVideoListItem"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="15">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="16">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"a.latestThumb.js-linkVideoThumb"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"href"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="18">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频打开链接"</span>
</span><span class="code-line line-number" line="19">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="20">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"a.thumbnailTitle"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="22">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="23">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频标题"</span>
</span><span class="code-line line-number" line="24">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="25">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="26">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"a.latestThumb.js-linkVideoThumb img"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="27">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="28">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"图片地址"</span>
</span><span class="code-line line-number" line="29">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="30">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="31">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">".videoUploaderBlock .usernameWrap a"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="32">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="33">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频发布者"</span>
</span><span class="code-line line-number" line="34">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="35">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="36">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">".videoDetailBlock .views var"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="37">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="38">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"观看次数"</span>
</span><span class="code-line line-number" line="39">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="40">        <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="41">          <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">".marker-overlays var.bgShadeEffect.duration"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="42">          <span class="token property">"attr"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="43">          <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"视频时长"</span>
</span><span class="code-line line-number" line="44">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="45">      <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="46">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="47">  <span class="token punctuation">]</span>
</span><span class="code-line line-number" line="48"><span class="token punctuation">}</span>
</span></code></pre>
<h2>执行流程</h2>
<ol>
<li>
<p><strong>点击阶段</strong>：</p>
<ul>
<li>按顺序执行所有点击规则</li>
<li>每个点击操作会尝试找到匹配元素</li>
<li>如果失败，会按指定的重试次数进行重试</li>
<li>每次点击后有指定的延迟时间</li>
</ul>
</li>
<li>
<p><strong>数据抓取阶段</strong>：</p>
<ul>
<li>对每个列表规则，查找所有匹配的列表项</li>
<li>对每个列表项，提取所有定义的字段</li>
<li>返回结构化数据</li>
</ul>
</li>
</ol>
<h2>结果格式</h2>
<p>执行后返回的数据格式示例：</p>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line line-number" line="1"><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token property">"视频打开链接"</span><span class="token operator">:</span> <span class="token string">"https://example.com/video1"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">    <span class="token property">"视频标题"</span><span class="token operator">:</span> <span class="token string">"示例视频1"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">    <span class="token property">"图片地址"</span><span class="token operator">:</span> <span class="token string">"https://example.com/thumb1.jpg"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">    <span class="token property">"视频发布者"</span><span class="token operator">:</span> <span class="token string">"用户A"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">    <span class="token property">"观看次数"</span><span class="token operator">:</span> <span class="token string">"1,234"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">    <span class="token property">"视频时长"</span><span class="token operator">:</span> <span class="token string">"05:30"</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">  <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">    <span class="token property">"视频打开链接"</span><span class="token operator">:</span> <span class="token string">"https://example.com/video2"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="12">    <span class="token property">"视频标题"</span><span class="token operator">:</span> <span class="token string">"示例视频2"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">    <span class="token property">"图片地址"</span><span class="token operator">:</span> <span class="token string">"https://example.com/thumb2.jpg"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">    <span class="token property">"视频发布者"</span><span class="token operator">:</span> <span class="token string">"用户B"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">    <span class="token property">"观看次数"</span><span class="token operator">:</span> <span class="token string">"5,678"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">    <span class="token property">"视频时长"</span><span class="token operator">:</span> <span class="token string">"10:15"</span>
</span><span class="code-line line-number" line="17">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="18"><span class="token punctuation">]</span>
</span></code></pre>
<h2>最佳实践</h2>
<ol>
<li>
<p><strong>选择器编写</strong>：</p>
<ul>
<li>尽量使用唯一的CSS选择器</li>
<li>避免使用过于复杂的选择器</li>
<li>优先使用class和id组合</li>
</ul>
</li>
<li>
<p><strong>点击操作</strong>：</p>
<ul>
<li>为关键操作设置足够的延迟时间</li>
<li>对重要操作设置重试机制</li>
<li>使用index精确指定要操作的元素</li>
</ul>
</li>
<li>
<p><strong>错误处理</strong>：</p>
<ul>
<li>在规则中设置合理的重试次数</li>
<li>监控执行日志，优化不稳定选择器</li>
</ul>
</li>
</ol>
<h2>注意事项</h2>
<ol>
<li>所有CSS选择器都是相对于当前文档的</li>
<li>索引从0开始计算</li>
<li>延迟时间单位为毫秒</li>
<li>如果元素不存在，对应字段值将为null</li>
<li>确保规则与目标网页结构匹配</li>
</ol>
