(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{3405:(e,t,a)=>{Promise.resolve().then(a.bind(a,3418))},3418:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),l=a(4292),n=a(2115),o=a(5654),c=a(528),s=a(337),i=a(9364),u=a(3767);function d(){let[e,t]=(0,n.useState)(""),{ws:a,connectedClientId:d,shellLog:f,setshellLog:h}=(0,o.h)(),x=r=>{if(!a||a.readyState!==WebSocket.OPEN){alert("WebSocket连接未就绪");return}if(!d){alert("请先选择要控制的客户端");return}if(!e.trim()){alert("输入内容不能为空");return}let l="CONTROL\n".concat(r,"\\n").concat(e);a.send(l),h("> ".concat(e,"\n"),!0),t("")};return(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)("h1",{className:(0,l.D)(),children:"远程控制台"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(s.r,{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"输入控制命令...",onKeyDown:e=>"Enter"===e.key&&x("shell")}),(0,r.jsx)(c.T,{onClick:()=>x("shell"),disabled:!e.trim(),children:"发送"})]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:d?"当前连接: ".concat(d):"未选择客户端"}),(0,r.jsx)(i.Z,{children:(0,r.jsx)(u.U,{className:"text-md whitespace-pre-line text-left text-green-400 min-h-[300px] max-h-[600px] overflow-auto",dangerouslySetInnerHTML:{__html:null==f?void 0:f.replaceAll("\\n","").replaceAll("\r\n","<br/>")}})})]})}},5654:(e,t,a)=>{"use strict";a.d(t,{WebSocketProvider:()=>c,h:()=>o});var r=a(5155),l=a(2115);let n=(0,l.createContext)(void 0);function o(){let e=(0,l.useContext)(n);if(!e)throw Error("useWebSocket 必须在 WebSocketProvider 内部使用");return e}function c(e){let{children:t}=e,[a,o]=(0,l.useState)([]),[c,s]=(0,l.useState)(null),[i,u]=(0,l.useState)(!0),[d,f]=(0,l.useState)(""),[h,x]=(0,l.useState)(null),[b,g]=(0,l.useState)(""),[k,m]=(0,l.useState)([]),S=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g(a=>t?"".concat(a).concat(e):e)},y=async()=>{try{let e=localStorage.getItem("serverapi"),t=localStorage.getItem("serverkey");if(!e||!t)throw Error("请先设置服务器API地址和密钥");let a=await fetch("http://".concat(e,"/api/auth/build?key=").concat(t)),r=await a.json();if(200!==r.code||!r.data)throw Error("获取TOKEN失败");return r.data}catch(e){throw f(e instanceof Error?e.message:"获取TOKEN时发生错误"),e}},p=async e=>{try{let t=await y();e.send("AUTH\n".concat(t))}catch(e){console.error("获取token失败:",e),f("获取验证token失败")}},E=async()=>{if(!c||c.readyState!==WebSocket.OPEN){f("WebSocket连接未就绪");return}u(!0),await p(c),u(!1)},v=(0,l.useCallback)(e=>{if(!c||c.readyState!==WebSocket.OPEN){f("WebSocket连接未就绪");return}x(e),c.send("CONNECT\n".concat(e)),console.log("请求连接客户端: ".concat(e))},[c]),w=(0,l.useCallback)(()=>{if(!c||c.readyState!==WebSocket.OPEN){f("WebSocket连接未就绪");return}h&&(c.send("DISCONNECT\n".concat(h)),console.log("断开连接客户端: ".concat(h))),x(null)},[c,h]),N=e=>{m(e.split("\\n").map(e=>{let t=e.split("|");if(t.length>=3){let[e,a,r]=t;return{name:e,time:a,type:"DIR"===r?"DIR":"FILE"}}return null}).filter(e=>null!==e))};return(0,l.useEffect)(()=>{let e=async()=>{let t=localStorage.getItem("serveraddress");if(!t){f("请先在设置中配置服务器地址"),u(!1);return}try{u(!0);let a=new WebSocket("ws://".concat(t));a.onopen=async()=>{console.log("WebSocket 连接已建立");try{let e=await y();a.send("AUTH\n".concat(e))}catch(e){f(e instanceof Error?e.message:"认证失败")}},a.onmessage=e=>{try{let t=JSON.parse(e.data);switch(console.log("接收到消息:",t),t.type){case"CLIENTS":Array.isArray(t.data)?o(t.data):o([t.data]);break;case"CONNECTION_STATUS":x(t.connected?t.clientId:null);break;case"ERROR":f(t.message);break;case"SHELL":S(t.data+"\n",!0);break;case"FILES":N(t.data);break;default:console.warn("未知消息类型:",t.type)}}catch(t){console.error("消息解析失败:",e.data)}},a.onerror=e=>{f("WebSocket 错误: ".concat(e))},a.onclose=t=>{1e3!==t.code&&setTimeout(e,3e3)},s(a)}catch(e){f("连接失败: ".concat(e))}finally{u(!1)}};e()},[]),(0,r.jsx)(n.Provider,{value:{clients:a,loading:i,error:d,ws:c,connectedClientId:h,shellLog:b,fileList:k,setshellLog:S,connectToClient:v,disconnectClient:w,refreshClients:E},children:t})}},4292:(e,t,a)=>{"use strict";a.d(t,{D:()=>l,V:()=>n});var r=a(7782);let l=(0,r.tv)({base:"tracking-tight inline font-semibold",variants:{color:{violet:"from-[#FF1CF7] to-[#b249f8]",yellow:"from-[#FF705B] to-[#FFB457]",blue:"from-[#5EA2EF] to-[#0072F5]",cyan:"from-[#00b7fa] to-[#01cfea]",green:"from-[#6FEE8D] to-[#17c964]",pink:"from-[#FF72E1] to-[#F54C7A]",foreground:"dark:from-[#FFFFFF] dark:to-[#4B4B4B]"},size:{sm:"text-3xl lg:text-4xl",md:"text-[2.3rem] lg:text-5xl leading-9",lg:"text-4xl lg:text-6xl"},fullWidth:{true:"w-full block"}},defaultVariants:{size:"md"},compoundVariants:[{color:["violet","yellow","blue","cyan","green","pink","foreground"],class:"bg-clip-text text-transparent bg-gradient-to-b"}]}),n=(0,r.tv)({base:"w-full md:w-1/2 my-2 text-lg lg:text-xl text-default-600 block max-w-full",variants:{fullWidth:{true:"!w-full"}},defaultVariants:{fullWidth:!0}})}},e=>{var t=t=>e(e.s=t);e.O(0,[966,528,628,337,82,441,517,358],()=>t(3405)),_N_E=e.O()}]);